var caldis={vertical:function(e,t,n){var r=n.x+n.width/2,n=n.y+n.height/2;return Math.pow(r-e,2)+1e4*Math.pow(n-t,2)},euclidean:function(e,t,n){var r=n.x+n.width/2,n=n.y+n.height/2;return Math.pow(r-e,2)+Math.pow(n-t,2)}},ldcaret={get:function(){var e,t,n=window.getSelection();return n.rangeCount?!(n=(e={ns:(t=n.getRangeAt(0)).startContainer,ne:t.endContainer,os:t.startOffset,oe:t.endOffset}).ns.childNodes[e.os])||"TEXTAREA"!==(t=n.nodeName)&&"INPUT"!==t?e:{ns:n,ne:n,os:n.selectionStart,oe:n.selectionEnd}:{}},set:function(e,t){var n,r,o,d,a,i,l;if(null==t&&(t=!1),null!=(e=null==e?{}:e).ns){if(n=e.ns,a=e.os,r=e.ne,o=e.oe,n.setSelectionRange)return n.focus(),n.setSelectionRange(a,null!=o?o:a);(d=document.createRange()).setStart(n,a),d.setEnd(null!=r?r:n,null!=o?o:a)}else e.startContainer&&(d=e);return t&&(l=document.createRange(),a=d.startContainer,e=d.startOffset,d.startContainer.nodeType!==Element.TEXT_NODE&&(a=(t=[(i=function(e,t){return e&&e.childNodes&&(t=i(e.childNodes[t],0))?t:e})(a,e),0])[0],e=t[1]),l.setStart(a,e),l.setEnd(a,e),d=l),(l=window.getSelection()).removeAllRanges(),l.addRange(d)},clear:function(){return window.getSelection().removeAllRanges()},getBoundingBox:function(){return window.getSelection().getRangeAt(0).getBoundingClientRect()},setContent:function(e){return this.insert(e)},insert:function(e){var t;if("string"==typeof e){if(!(t=ldcaret.get())||!t.ns)return;if(t.ns.setRangeText)return t.ns.setRangeText(e);e=document.createTextNode(e)}return(t=window.getSelection().getRangeAt(0)).deleteContents(),t.insertNode(e)},getContent:function(e){var t;return e?((t=document.createRange()).setStart(e.ns,e.os),t.setEnd(e.ne,e.oe),t.toString()):window.getSelection().toString()},byPtr:function(e){var t=e.node,n=e.x,r=e.y,o=e.range,e=e.method,o=ldcaret._byPtr({node:t,x:n,y:r,range:o,method:e}),e=o.range.getBoundingClientRect();return o.box=e,o},_byPtr:function(e){var t,n,r,o,d,a=e.node,i=e.x,l=e.y,c=e.range,s=e.method;if(c=c||document.createRange(),a.nodeType===Element.TEXT_NODE)return ldcaret._byPtrInText({node:a,x:i,y:l,range:c,method:s});for(t=null,n=0,r=a.childNodes.length;n<r;++n)o=n,o=ldcaret._byPtr({node:a.childNodes[o],x:i,y:l,range:c,method:s}),(!t||o.min<t.min)&&(t=o);return t||(d=a.parentNode,e=Array.from(d.childNodes),(c=document.createRange()).setStart(d,e.indexOf(a)),c.setEnd(d,e.indexOf(a)+1),e=c.getBoundingClientRect(),t={min:caldis[s||"vertical"](i,l,e),range:c}),t},_byPtrInText:function(e){for(var t,n,r,o,d=e.node,a=e.x,i=e.y,l=e.method,c=document.createRange(),s=0,u=d.length+1;s<u;++s)t=s,c.setStart(d,t),n=c.getBoundingClientRect(),n=caldis[l||"vertical"](a,i,n),(null==o||n<o)&&(r=(n=[t,n])[0],o=n[1]);return c.setStart(d,r),c.setEnd(d,r),{min:o,range:c}}};"undefined"!=typeof module&&null!==module?module.exports=ldcaret:"undefined"!=typeof window&&null!==window&&(window.ldcaret=ldcaret);
